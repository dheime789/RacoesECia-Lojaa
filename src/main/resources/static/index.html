<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RVNFCZ33G8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-RVNFCZ33G8');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Ra√ß√µes & Cia</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* Estilo Base Profissional */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f4f9; margin: 0; padding: 20px; }

        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }

        h1 { color: #333; border-bottom: 3px solid #b30000; padding-bottom: 15px; margin-top: 0; display: flex; align-items: center; gap: 10px; }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #b30000; color: white; font-weight: 600; text-transform: uppercase; font-size: 14px; }
        tr:hover { background-color: #f9f9f9; }

        /* Imagem na tabela */
        .img-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; }

        /* Bot√µes */
        .btn-novo { background-color: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-novo:hover { background-color: #218838; transform: translateY(-2px); }

        .btn-delete { background-color: #fff; color: #dc3545; border: 1px solid #dc3545; padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .btn-delete:hover { background-color: #dc3545; color: white; }

        /* MODAL (Janela de Cadastro) */
        .modal-fundo { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: white; padding: 30px; border-radius: 10px; width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; }
        .modal h2 { margin-top: 0; color: #b30000; border-bottom: 1px solid #eee; padding-bottom: 10px; }

        .campo { margin-bottom: 15px; }
        .campo label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 14px; }
        .campo input { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
        .campo input:focus { border-color: #b30000; outline: none; }

        .botoes-modal { text-align: right; margin-top: 20px; }
        .btn-salvar { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-cancelar { background-color: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üì¶ Gest√£o de Estoque</h1>

    <button onclick="abrirModal()" class="btn-novo">
        <span class="material-icons">add_circle</span> Novo Produto
    </button>

    <table>
        <thead>
        <tr>
            <th>Foto</th>
            <th>Produto</th>
            <th>Marca</th>
            <th>Pre√ßo</th>
            <th>Estoque</th>
            <th>A√ß√µes</th>
        </tr>
        </thead>
        <tbody id="tabela-produtos">
        </tbody>
    </table>
</div>

<div id="meuModal" class="modal-fundo">
    <div class="modal">
        <h2>Cadastrar Produto</h2>

        <div class="campo">
            <label>Nome do Produto*</label>
            <input type="text" id="nome" placeholder="Ex: Ra√ß√£o Golden Frango 15kg">
        </div>

        <div class="campo">
            <label>Link da Foto (URL)</label>
            <input type="text" id="imagemUrl" placeholder="Cole o link da imagem aqui">
        </div>

        <div class="campo" style="background: #fdfadd; padding: 10px; border-radius: 5px; border: 1px solid #faeccc;">
            <label>üè∑Ô∏è Tags (Palavras-chave e Erros)</label>
            <input type="text" id="tagsIa" placeholder="Ex: golden, goldem, golder, cachorro, adulto">
            <small style="color: #666; font-size: 11px;">Separe por v√≠rgula. Isso ajuda o rob√¥ a entender erros de digita√ß√£o.</small>
        </div>

        <div class="campo">
            <label>Marca</label>
            <input type="text" id="marca" placeholder="Ex: Golden">
        </div>

        <div class="campo">
            <label>Categoria</label>
            <input type="text" id="categoria" placeholder="Ex: Adulto, Filhote, Gato">
        </div>

        <div class="campo">
            <label>Pre√ßo (R$)*</label>
            <input type="number" id="preco" step="0.01" placeholder="0.00">
        </div>

        <div class="campo">
            <label>Estoque (Qtd)</label>
            <input type="number" id="estoque" placeholder="0">
        </div>

        <div class="botoes-modal">
            <button onclick="fecharModal()" class="btn-cancelar">Cancelar</button>
            <button onclick="salvarProduto()" class="btn-salvar">Salvar Produto</button>
        </div>
    </div>
</div>

<script>
    // Carrega a lista assim que abre a p√°gina
    carregarProdutos();

    // Fun√ß√µes visuais
    function abrirModal() {
        // Limpa os campos antes de abrir
        document.getElementById('nome').value = '';
        document.getElementById('imagemUrl').value = '';
        document.getElementById('tagsIa').value = ''; // Limpa as tags
        document.getElementById('marca').value = '';
        document.getElementById('categoria').value = '';
        document.getElementById('preco').value = '';
        document.getElementById('estoque').value = '';

        document.getElementById('meuModal').style.display = 'flex';
    }

    function fecharModal() { document.getElementById('meuModal').style.display = 'none'; }

    // 1. LISTAR PRODUTOS
    async function carregarProdutos() {
        try {
            const res = await fetch('/produtos');
            const lista = await res.json();
            const tabela = document.getElementById('tabela-produtos');
            tabela.innerHTML = '';

            lista.forEach(p => {
                tabela.innerHTML += `
                    <tr>
                        <td><img src="${p.imagemUrl || 'https://via.placeholder.com/50?text=Foto'}" class="img-thumb"></td>
                        <td>
                            <b>${p.nomeComercial}</b><br>
                            <span style="font-size:12px; color:#777;">${p.categoria || '-'}</span>
                        </td>
                        <td>${p.marca || '-'}</td>
                        <td style="color: #28a745; font-weight:bold;">R$ ${p.preco.toFixed(2)}</td>
                        <td>${p.estoque} un</td>
                        <td>
                            <button onclick="deletar(${p.id})" class="btn-delete" title="Excluir">
                                <span class="material-icons" style="font-size:16px;">delete</span>
                            </button>
                        </td>
                    </tr>`;
            });
        } catch (erro) {
            console.error('Erro ao listar:', erro);
        }
    }

    // 2. SALVAR (COM AS TAGS NOVAS!)
    async function salvarProduto() {
        const nome = document.getElementById('nome').value;
        const preco = document.getElementById('preco').value;

        if (!nome || !preco) {
            alert("Nome e Pre√ßo s√£o obrigat√≥rios!");
            return;
        }

        const produto = {
            nomeComercial: nome,
            imagemUrl: document.getElementById('imagemUrl').value,
            tagsIa: document.getElementById('tagsIa').value, // <--- Aqui vai pro banco!
            marca: document.getElementById('marca').value,
            categoria: document.getElementById('categoria').value,
            preco: preco,
            estoque: document.getElementById('estoque').value || 0
        };

        try {
            const resposta = await fetch('/produtos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(produto)
            });

            if (resposta.ok) {
                alert('Produto salvo com sucesso!');
                fecharModal();
                carregarProdutos(); // Atualiza a tabela na hora
            } else {
                alert('Erro ao salvar. Verifique o console.');
            }
        } catch (erro) {
            alert('Erro de conex√£o.');
        }
    }

    // 3. DELETAR
    async function deletar(id) {
        if(confirm('Tem certeza que deseja excluir este produto?')) {
            await fetch(`/produtos/${id}`, { method: 'DELETE' });
            carregarProdutos();
        }
    }
</script>

</body>
</html>